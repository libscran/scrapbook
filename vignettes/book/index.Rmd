--- 
title: "Single-cell RNA-seq analysis with scrapper"
documentclass: book
bibliography: [ref.bib]
biblio-style: apalike
link-citations: yes
favicon: "favicon.ico"
description: "Or: how I learned to stop worrying and love the t-SNEs."
cover-image: "https://github.com/Bioconductor/BiocStickers/raw/devel/Bioconductor/Bioconductor-serial.gif"
github-repo: libscran/scrapbook
---

```{r, echo=FALSE}
library(BiocStyle)
.gh_url <- file.path('https://github.com', rmarkdown::metadata[['github-repo']])
knitr::opts_chunk$set(message=FALSE, warning=FALSE, error=FALSE)

curpath <- getwd()
while (curpath != (nextpath <- dirname(curpath))) {
    target <- file.path(curpath, "DESCRIPTION")
    if (file.exists(target)) {
        break
    }
    curpath <- nextpath
}
if (!file.exists(target)) {
    stop("failed to find a DESCRIPTION file")
}

info <- read.dcf(target)
authors <- eval(parse(text=info[,"Authors@R"]))
```

---
author: `r paste(paste('\n- name:', format(authors, include=c('given', 'family', 'role'))), collapse='')`
url: "`r .gh_url`"
---

# Introduction {-}

<a href="https://bioconductor.org"><img src="`r rmarkdown::metadata[["cover-image"]]`" width="200" alt="Bioconductor Sticker" align="right" style="margin: 0 1em 0 1em" /></a> 

Single-cell RNA-sequencing (scRNA-seq) - the name says it all, really.
Long story short, we isolate single cells and we sequence their transcriptomes to quantify the expression of each gene in each cell [@kolodziejczyk2015technology].
Our aim is to explore heterogeneity in a cell population at the resolution of individual cells,
typically to identify subpopulations or states that would not be apparent from population-level (i.e., "bulk") assays.
Since its inception, scRNA-seq has emerged as one of the premier techniques for publishing genomics papers.
Occasionally, it is even used to do some actual science.

This book describes a computational workflow for analyzing scRNA-seq data using the [R/Bioconductor](https://bioconductor.org) ecosystem.
Most of the heavy lifting is performed using the `r Biocpkg("scrapper")` package, while `r Biocpkg("scater")` handles the plotting.
We rely heavily on Bioconductor data structures like the `SingleCellExperiment` class,
so readers should check out the `r Biocpkg("SingleCellExperiment", "intro.html", label="associated documentation")` if they haven't already.
Each chapter is devoted to a particular step in the analysis where we provide its theoretical rationale, the associated code, and some typical results from real public datasets.
This includes:

- Quality control, to filter out cells that were damaged or not properly sequenced.
- Normalization, to remove cell-specific biases. 
- Feature selection, to identify genes with interesting biologial variation.
- Principal components analysis, to compact and denoise the data.
- Visualization, to generate the all-important Figure 1 of our manuscript.
- Clustering, to summarize the data into groups of similar cells. 
- Marker detection, to assign biological meaning to each cluster based on its upregulated genes.

Truth be told, you don't actually need to read this book if you don't care about how/why things are done.
Just copy and paste the following into your R session:

```{r}
# Pulling out an example dataset.
library(scRNAseq)
sce.zeisel <- ZeiselBrainData()

# Running the full analysis pipeline.
library(scrapper)
is.mito.zeisel <- grep("^mt-", rownames(sce.zeisel))
res.zeisel <- analyze.se(sce.zeisel, rna.qc.subsets=list(MT=is.mito.zeisel))

# Visualizing the cluster assignments for each cell:
library(scater)
plotReducedDim(res.zeisel$x, "TSNE", colour_by="graph.cluster")

# Looking at the top markers for cluster 1:
previewMarkers(res.zeisel$markers$rna[["1"]])
```

And that's it.
Sometimes, ignorance is bliss, and it's better to not know how the sausage is made.
But hey - you're already here, so why not keep reading?
Anecdotal studies indicate that exposure to the inner workings of scRNA-seq data analysis leads to only minor deteriorations in mental health.

Any questions can be posted at [Bioconductor support site](https://support.bioconductor.org) or the [GitHub page for this book](https://github.com/libscran/scrapbook).
